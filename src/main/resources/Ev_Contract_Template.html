<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>H·ª£p ƒë·ªìng S·ªü h·ªØu Xe Chung ‚Ä¢ EVShare</title>
    <style>
        :root {
            --ink: #111827;
            --muted: #6b7280;
            --primary: #0ea5e9;
            --border: #e5e7eb;
        }

        * {
            box-sizing: border-box
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            color: var(--ink);
        }

        .toolbar {
            position: sticky;
            top: 0;
            z-index: 10;
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 12px;
            display: flex;
            gap: 8px;
            align-items: center
        }

        .btn {
            border: 1px solid var(--border);
            background: white;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600
        }

        .btn.primary {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary)
        }

        .btn:active {
            transform: translateY(1px)
        }

        .page {
            max-width: 900px;
            margin: 24px auto;
            background: white;
            padding: 40px 48px;
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.06)
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 800;
            letter-spacing: .4px
        }

        .logo-mark {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: linear-gradient(135deg, #22d3ee, #3b82f6)
        }

        h1 {
            margin: 8px 0 0;
            font-size: 26px;
            line-height: 1.25
        }

        .subtitle {
            color: var(--muted)
        }

        .meta, .section > h2 {
            display: flex;
            align-items: center;
            gap: 8px
        }

        .grid {
            display: grid;
            grid-template-columns:repeat(12, 1fr);
            gap: 16px
        }

        .card {
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 16px
        }

        .kvs {
            display: grid;
            grid-template-columns:180px 1fr;
            row-gap: 10px;
            column-gap: 12px
        }

        .key {
            color: var(--muted)
        }

        .val {
            font-weight: 600
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        th, td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            text-align: left
        }

        th {
            background: #fafafa;
            font-size: 14px
        }

        .section {
            margin-top: 24px
        }

        .section > h2 {
            font-size: 18px;
            margin: 0 0 10px
        }

        .muted {
            color: var(--muted)
        }

        .signatures {
            display: grid;
            grid-template-columns:repeat(2, 1fr);
            gap: 24px
        }

        .sig-box {
            border: 1px dashed var(--border);
            border-radius: 12px;
            padding: 14px
        }

        .sig-line {
            margin-top: 40px;
            border-top: 1px solid var(--border);
            padding-top: 6px;
            font-weight: 600
        }

        .footnote {
            margin-top: 24px;
            font-size: 12px;
            color: var(--muted)
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            background: #eef2ff;
            color: #3730a3;
            border: 1px solid #e0e7ff
        }

        .flex {
            display: flex;
            gap: 10px;
            align-items: center
        }

        .right {
            text-align: right
        }

        .nowrap {
            white-space: nowrap
        }

        .break-avoid {
            break-inside: avoid
        }

        @media print {
            .toolbar {
                display: none
            }

            body {
                background: white
            }

            .page {
                box-shadow: none;
                border: none;
                margin: 0;
                border-radius: 0;
                page-break-after: always
            }

            a[href]:after {
                content: ""
            }
        }
    </style>
</head>
<body>
<!-- Top toolbar (won't print) -->
<div class="toolbar">
    <button class="btn" onclick="window.print()">üñ®Ô∏è In / L∆∞u PDF</button>
    <button class="btn" onclick="fillDemo()">‚ú® ƒê·ªï d·ªØ li·ªáu m·∫´u</button>
    <button class="btn primary" onclick="clearAll()">‚ôªÔ∏è X√≥a d·ªØ li·ªáu</button>
    <span class="muted">M·∫πo: sau khi xem h·ª£p ƒë·ªìng, b·∫•m In ‚Üí L∆∞u d∆∞·ªõi d·∫°ng PDF ƒë·ªÉ g·ª≠i k√Ω.</span>
</div>

<!-- A4-like page -->
<div class="page" id="contract">
    <header>
        <div class="logo">
            <div class="logo-mark" aria-hidden="true"></div>
            <div>
                <div>EVShare</div>
                <div class="subtitle">H·ªá th·ªëng ƒë·ªìng s·ªü h·ªØu xe ƒëi·ªán</div>
            </div>
        </div>
        <div class="right">
            <div class="badge" id="contract-status">DRAFT</div>
            <br/>
            <small class="muted">S·ªë h·ª£p ƒë·ªìng: <span data-text="contract.number">‚Äî</span></small>
        </div>
    </header>

    <h1>H·ª¢P ƒê·ªíNG S·ªû H·ªÆU XE CHUNG</h1>
    <div class="subtitle">CƒÉn c·ª© theo th·ªèa thu·∫≠n gi·ªØa c√°c B√™n thu·ªôc Nh√≥m s·ªü h·ªØu <b data-text="group.name">‚Äî</b>.</div>

    <!-- Meta blocks -->
    <div class="grid" style="margin-top:16px">
        <div class="card break-avoid" style="grid-column: span 7">
            <div class="meta"><strong>Th√¥ng tin ph∆∞∆°ng ti·ªán</strong></div>
            <div class="kvs" style="margin-top:10px">
                <div class="key">H√£ng / Model</div>
                <div class="val" data-text="vehicle.model">‚Äî</div>
                <div class="key">Bi·ªÉn s·ªë</div>
                <div class="val" data-text="vehicle.plate">‚Äî</div>
                <div class="key">S·ªë VIN</div>
                <div class="val" data-text="vehicle.vin">‚Äî</div>
                <div class="key">NƒÉm SX</div>
                <div class="val" data-text="vehicle.year">‚Äî</div>
            </div>
        </div>
        <div class="card break-avoid" style="grid-column: span 5">
            <div class="meta"><strong>Hi·ªáu l·ª±c h·ª£p ƒë·ªìng</strong></div>
            <div class="kvs" style="margin-top:10px">
                <div class="key">Ng√†y hi·ªáu l·ª±c</div>
                <div class="val" data-text="contract.effectiveDate">‚Äî</div>
                <div class="key">Ng√†y k·∫øt th√∫c</div>
                <div class="val" data-text="contract.endDate">‚Äî</div>
                <div class="key">K·ª≥ h·∫°n</div>
                <div class="val" data-text="contract.termLabel">‚Äî</div>
                <div class="key">Template</div>
                <div class="val" data-text="contract.template">‚Äî</div>
            </div>
        </div>
    </div>

    <!-- Owners table -->
    <div class="section break-avoid">
        <h2>1. C√°c B√™n ƒë·ªìng s·ªü h·ªØu</h2>
        <table>
            <thead>
            <tr>
                <th>#</th>
                <th>H·ªç t√™n</th>
                <th>Li√™n h·ªá</th>
                <th>Gi·∫•y t·ªù</th>
                <th class="right">T·ª∑ l·ªá (%)</th>
            </tr>
            </thead>
            <tbody id="owners-tbody">
            <!-- injected rows -->
            </tbody>
        </table>
        <div class="muted" style="margin-top:6px">T·ªïng t·ª∑ l·ªá: <b><span id="ownership-sum">0</span>%</b></div>
    </div>

    <!-- Finance terms -->
    <div class="section">
        <h2>2. G√≥p v·ªën & Qu·ªπ v·∫≠n h√†nh</h2>
        <div class="kvs" style="margin-top:6px">
            <div class="key">Gi√° tr·ªã xe</div>
            <div class="val nowrap" data-text="finance.vehiclePrice">‚Äî</div>
            <div class="key">Qu·ªπ chung ban ƒë·∫ßu</div>
            <div class="val nowrap" data-text="finance.initialFund">‚Äî</div>
            <div class="key">T√†i kho·∫£n qu·ªπ</div>
            <div class="val" data-text="finance.fundAccount">‚Äî</div>
            <div class="key">Nguy√™n t·∫Øc g√≥p</div>
            <div class="val" data-text="finance.contributionRule">‚Äî</div>
        </div>
        <p class="muted">C√°c kho·∫£n chi b·∫£o d∆∞·ª°ng, s·∫°c, v·ªá sinh‚Ä¶ ƒë∆∞·ª£c thanh to√°n t·ª´ Qu·ªπ chung; kho·∫£n c√° nh√¢n (n·∫øu c√≥) do
            c√° nh√¢n chi tr·∫£ theo b√∫t to√°n b√π tr·ª´.</p>
    </div>

    <!-- Usage & rules -->
    <div class="section">
        <h2>3. Quy·ªÅn s·ª≠ d·ª•ng & L·ªãch ƒë·∫∑t</h2>
        <p>Vi·ªác s·ª≠ d·ª•ng xe ƒë∆∞·ª£c th·ª±c hi·ªán th√¥ng qua h·ªá th·ªëng ƒë·∫∑t l·ªãch. Quy t·∫Øc ∆∞u ti√™n: <span
                data-text="usage.rule">‚Äî</span>. M·ªói B√™n cam k·∫øt tu√¢n th·ªß l·ªãch ƒë·∫∑t v√† ho√†n tr·∫£ ƒë√∫ng h·∫πn.</p>
    </div>

    <div class="section">
        <h2>4. B·∫£o d∆∞·ª°ng, S·ª≠a ch·ªØa & B·∫£o hi·ªÉm</h2>
        <p>Xe ƒë∆∞·ª£c b·∫£o d∆∞·ª°ng ƒë·ªãnh k·ª≥ theo khuy·∫øn ngh·ªã c·ªßa h√£ng. Tr√°ch nhi·ªám ph√™ duy·ªát chi ph√≠: <span
                data-text="maintenance.approval">‚Äî</span>. H·ª£p ƒë·ªìng b·∫£o hi·ªÉm: <span
                data-text="maintenance.insurance">‚Äî</span>.</p>
    </div>

    <div class="section">
        <h2>5. Gi·∫£i quy·∫øt tranh ch·∫•p</h2>
        <p>Tranh ch·∫•p ph√°t sinh ƒë∆∞·ª£c ghi nh·∫≠n tr√™n h·ªá th·ªëng v√† ∆∞u ti√™n h√≤a gi·∫£i trong Nh√≥m. C∆° ch·∫ø bi·ªÉu quy·∫øt: <span
                data-text="dispute.voting">‚Äî</span>. Th·∫©m quy·ªÅn cu·ªëi c√πng theo ph√°p lu·∫≠t hi·ªán h√†nh.</p>
    </div>

    <div class="section">
        <h2>6. ƒêi·ªÅu kho·∫£n chung</h2>
        <ul>
            <li>H·ª£p ƒë·ªìng c√≥ hi·ªáu l·ª±c khi t·∫•t c·∫£ B√™n ƒë·ªìng s·ªü h·ªØu ƒë·ªìng √Ω v√† k√Ω.</li>
            <li>C√°c ph·ª• l·ª•c (n·∫øu c√≥) l√† b·ªô ph·∫≠n kh√¥ng t√°ch r·ªùi c·ªßa H·ª£p ƒë·ªìng.</li>
            <li>H·ªá th·ªëng l∆∞u v·∫øt phi√™n b·∫£n, th·ªùi ƒëi·ªÉm k√Ω v√† danh t√≠nh ng∆∞·ªùi k√Ω.</li>
        </ul>
    </div>

    <!-- Signatures -->
    <div class="section break-avoid">
        <h2>7. Ch·ªØ k√Ω c√°c B√™n</h2>
        <div id="signature-grid" class="signatures">
            <!-- signature boxes injected here -->
        </div>
        <div class="footnote">Khi k√Ω ƒëi·ªán t·ª≠, m·ªói √¥ ch·ªØ k√Ω s·∫Ω hi·ªÉn th·ªã t√™n, th·ªùi gian k√Ω v√† fingerprint c·ªßa ch·ªØ k√Ω.
        </div>
    </div>

    <div class="section" style="margin-top:28px">
        <div class="muted">ƒê·ªãa ƒëi·ªÉm k√Ω: <span data-text="contract.location">‚Äî</span> ¬∑ Ng√†y: <span
                data-text="contract.signDate">‚Äî</span></div>
    </div>
</div>

<script>
    // --- Tiny binding helper -------------------------------------------------
    function setText(selectorKey, value) {
        document.querySelectorAll(`[data-text="${selectorKey}"]`).forEach(el => el.textContent = value ?? '‚Äî');
    }

    function fmtCurrency(v) {
        if (v == null) return '‚Äî';
        try {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND',
                maximumFractionDigits: 0
            }).format(v);
        } catch {
            return String(v);
        }
    }

    function render(data) {
        // Contract meta
        setText('contract.number', data.contract.number);
        setText('group.name', data.group.name);
        setText('vehicle.model', data.vehicle.model);
        setText('vehicle.plate', data.vehicle.plate);
        setText('vehicle.vin', data.vehicle.vin);
        setText('vehicle.year', data.vehicle.year);
        setText('contract.effectiveDate', data.contract.effectiveDate);
        setText('contract.endDate', data.contract.endDate);
        setText('contract.termLabel', data.contract.termLabel);
        setText('contract.template', data.contract.template);
        setText('contract.location', data.contract.location);
        setText('contract.signDate', data.contract.signDate);

        // Finance
        setText('finance.vehiclePrice', fmtCurrency(data.finance.vehiclePrice));
        setText('finance.initialFund', fmtCurrency(data.finance.initialFund));
        setText('finance.fundAccount', data.finance.fundAccount);
        setText('finance.contributionRule', data.finance.contributionRule);

        // Usage / Maintenance / Dispute
        setText('usage.rule', data.usage.rule);
        setText('maintenance.approval', data.maintenance.approval);
        setText('maintenance.insurance', data.maintenance.insurance);
        setText('dispute.voting', data.dispute.voting);

        // Status badge
        const badge = document.getElementById('contract-status');
        badge.textContent = (data.contract.status || 'DRAFT').toUpperCase();

        // Owners
        const tbody = document.getElementById('owners-tbody');
        tbody.innerHTML = '';
        let sum = 0;
        (data.owners || []).forEach((o, i) => {
            sum += Number(o.share || 0);
            const tr = document.createElement('tr');
            tr.innerHTML = `
          <td>${i + 1}</td>
          <td><strong>${o.name}</strong></td>
          <td>${o.phone || ''}${o.email ? ' ¬∑ ' + o.email : ''}</td>
          <td>${o.idType || ''} ${o.idNo || ''}</td>
          <td class="right">${(o.share ?? 0)}%</td>`;
            tbody.appendChild(tr);
        });
        document.getElementById('ownership-sum').textContent = sum;

        // Signatures grid
        const grid = document.getElementById('signature-grid');
        grid.innerHTML = '';
        (data.owners || []).forEach((o) => {
            const box = document.createElement('div');
            box.className = 'sig-box';
            box.innerHTML = `
          <div><strong>${o.name}</strong></div>
          <div class="muted">K√Ω & ghi r√µ h·ªç t√™n</div>
          <div class="sig-line">Ch·ªØ k√Ω</div>
          <div class="muted" style="font-size:12px">T·ª∑ l·ªá: ${o.share ?? 0}%</div>`;
            grid.appendChild(box);
        });
    }

    // --- Demo & helpers ------------------------------------------------------
    function fillDemo() {
        const demo = {
            contract: {
                number: 'EVS-2025-001',
                effectiveDate: '2025-10-20',
                endDate: '2026-10-19',
                termLabel: '12 th√°ng',
                template: 'STANDARD-1.0',
                status: 'Draft',
                location: 'H√† N·ªôi',
                signDate: '2025-10-20'
            },
            group: {name: 'EVShare ‚Äì Nh√≥m A'},
            vehicle: {model: 'VinFast VF 8 Plus', plate: '30A-123.45', vin: 'RLVZZZ1EZBW000001', year: 2024},
            finance: {
                vehiclePrice: 950_000_000,
                initialFund: 30_000_000,
                fundAccount: 'MB Bank 0123456789 ‚Äì EVShare Group A',
                contributionRule: 'Theo t·ª∑ l·ªá s·ªü h·ªØu'
            },
            usage: {rule: 'ƒêi·ªÉm t√≠n d·ª•ng l·ªãch s·ª≠ & phi√™n b·ªëc thƒÉm tu·∫ßn'},
            maintenance: {
                approval: 'Bi·ªÉu quy·∫øt > 50% theo t·ª∑ l·ªá s·ªü h·ªØu cho chi > 5 tri·ªáu',
                insurance: 'PVI ‚Äì G√≥i v·∫≠t ch·∫•t to√†n di·ªán'
            },
            dispute: {voting: 'ƒêa s·ªë theo t·ª∑ l·ªá s·ªü h·ªØu; n·∫øu ho√† 50/50, ∆∞u ti√™n l·ªãch s·ª≠ ƒë√≥ng g√≥p'},
            owners: [
                {
                    name: 'Nguy·ªÖn VƒÉn A',
                    phone: '0901 234 567',
                    email: 'a@evshare.vn',
                    idType: 'CCCD',
                    idNo: '012345678901',
                    share: 40
                },
                {
                    name: 'Tr·∫ßn Th·ªã B',
                    phone: '0902 234 567',
                    email: 'b@evshare.vn',
                    idType: 'CCCD',
                    idNo: '012345678902',
                    share: 35
                },
                {
                    name: 'L√™ VƒÉn C',
                    phone: '0903 234 567',
                    email: 'c@evshare.vn',
                    idType: 'CCCD',
                    idNo: '012345678903',
                    share: 25
                }
            ]
        };
        render(demo);
    }

    function clearAll() {
        location.reload();
    }

    // Auto demo on first load for preview
    fillDemo();
</script>
</body>
</html>
