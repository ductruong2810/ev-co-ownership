<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Há»£p Ä‘á»“ng Sá»Ÿ há»¯u Xe Chung â€¢ EVShare</title>
    <style>
        :root{
            --ink:#111827; --muted:#6b7280; --primary:#0ea5e9; --border:#e5e7eb;
        }
        *{box-sizing:border-box}
        html,body{margin:0; padding:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--ink);}
        .toolbar{position:sticky; top:0; z-index:10; background:white; border-bottom:1px solid var(--border); padding:12px; display:flex; gap:8px; align-items:center}
        .btn{border:1px solid var(--border); background:white; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600}
        .btn.primary{background:var(--primary); color:#fff; border-color:var(--primary)}
        .btn:active{transform:translateY(1px)}
        .page{max-width:900px; margin:24px auto; background:white; padding:40px 48px; border:1px solid var(--border); border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,0.06)}
        header{display:flex; justify-content:space-between; align-items:center; gap:16px; margin-bottom:24px}
        .logo{display:flex; align-items:center; gap:8px; font-weight:800; letter-spacing:.4px}
        .logo-mark{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg,#22d3ee,#3b82f6)}
        h1{margin:8px 0 0; font-size:26px; line-height:1.25}
        .subtitle{color:var(--muted)}
        .meta, .section>h2{display:flex; align-items:center; gap:8px}
        .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
        .card{border:1px solid var(--border); border-radius:14px; padding:16px}
        .kvs{display:grid; grid-template-columns:180px 1fr; row-gap:10px; column-gap:12px}
        .key{color:var(--muted)}
        .val{font-weight:600}
        table{width:100%; border-collapse:collapse}
        th,td{padding:10px 12px; border-bottom:1px solid var(--border); text-align:left}
        th{background:#fafafa; font-size:14px}
        .section{margin-top:24px}
        .section>h2{font-size:18px; margin:0 0 10px}
        .muted{color:var(--muted)}
        .signatures{display:grid; grid-template-columns:repeat(2,1fr); gap:24px}
        .sig-box{border:1px dashed var(--border); border-radius:12px; padding:14px}
        .sig-line{margin-top:40px; border-top:1px solid var(--border); padding-top:6px; font-weight:600}
        .footnote{margin-top:24px; font-size:12px; color:var(--muted)}
        .badge{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#eef2ff; color:#3730a3; border:1px solid #e0e7ff}
        .flex{display:flex; gap:10px; align-items:center}
        .right{text-align:right}
        .nowrap{white-space:nowrap}
        .break-avoid{break-inside:avoid}
        @media print{
            .toolbar{display:none}
            body{background:white}
            .page{box-shadow:none; border:none; margin:0; border-radius:0; page-break-after:always}
            a[href]:after{content:""}
        }
    </style>
</head>
<body>
<!-- Top toolbar (won't print) -->
<div class="toolbar">
    <button class="btn" onclick="window.print()">ğŸ–¨ï¸ In / LÆ°u PDF</button>
    <button class="btn" onclick="fillDemo()">âœ¨ Äá»• dá»¯ liá»‡u máº«u</button>
    <button class="btn primary" onclick="clearAll()">â™»ï¸ XÃ³a dá»¯ liá»‡u</button>
    <span class="muted">Máº¹o: sau khi xem há»£p Ä‘á»“ng, báº¥m In â†’ LÆ°u dÆ°á»›i dáº¡ng PDF Ä‘á»ƒ gá»­i kÃ½.</span>
</div>

<!-- A4-like page -->
<div class="page" id="contract">
    <header>
        <div class="logo">
            <div class="logo-mark" aria-hidden="true"></div>
            <div>
                <div>EVShare</div>
                <div class="subtitle">Há»‡ thá»‘ng Ä‘á»“ng sá»Ÿ há»¯u xe Ä‘iá»‡n</div>
            </div>
        </div>
        <div class="right">
            <div class="badge" id="contract-status">DRAFT</div><br/>
            <small class="muted">Sá»‘ há»£p Ä‘á»“ng: <span data-text="contract.number">â€”</span></small>
        </div>
    </header>

    <h1>Há»¢P Äá»’NG Sá» Há»®U XE CHUNG</h1>
    <div class="subtitle">CÄƒn cá»© theo thá»a thuáº­n giá»¯a cÃ¡c BÃªn thuá»™c NhÃ³m sá»Ÿ há»¯u <b data-text="group.name">â€”</b>.</div>

    <!-- Meta blocks -->
    <div class="grid" style="margin-top:16px">
        <div class="card break-avoid" style="grid-column: span 7">
            <div class="meta"><strong>ThÃ´ng tin phÆ°Æ¡ng tiá»‡n</strong></div>
            <div class="kvs" style="margin-top:10px">
                <div class="key">HÃ£ng / Model</div><div class="val" data-text="vehicle.model">â€”</div>
                <div class="key">Biá»ƒn sá»‘</div><div class="val" data-text="vehicle.plate">â€”</div>
                <div class="key">Sá»‘ VIN</div><div class="val" data-text="vehicle.vin">â€”</div>
                <div class="key">NÄƒm SX</div><div class="val" data-text="vehicle.year">â€”</div>
            </div>
        </div>
        <div class="card break-avoid" style="grid-column: span 5">
            <div class="meta"><strong>Hiá»‡u lá»±c há»£p Ä‘á»“ng</strong></div>
            <div class="kvs" style="margin-top:10px">
                <div class="key">NgÃ y hiá»‡u lá»±c</div><div class="val" data-text="contract.effectiveDate">â€”</div>
                <div class="key">NgÃ y káº¿t thÃºc</div><div class="val" data-text="contract.endDate">â€”</div>
                <div class="key">Ká»³ háº¡n</div><div class="val" data-text="contract.termLabel">â€”</div>
                <div class="key">Template</div><div class="val" data-text="contract.template">â€”</div>
            </div>
        </div>
    </div>

    <!-- Owners table -->
    <div class="section break-avoid">
        <h2>1. CÃ¡c BÃªn Ä‘á»“ng sá»Ÿ há»¯u</h2>
        <table>
            <thead>
            <tr>
                <th>#</th>
                <th>Há» tÃªn</th>
                <th>LiÃªn há»‡</th>
                <th>Giáº¥y tá»</th>
                <th class="right">Tá»· lá»‡ (%)</th>
            </tr>
            </thead>
            <tbody id="owners-tbody">
            <!-- injected rows -->
            </tbody>
        </table>
        <div class="muted" style="margin-top:6px">Tá»•ng tá»· lá»‡: <b><span id="ownership-sum">0</span>%</b></div>
    </div>

    <!-- Finance terms -->
    <div class="section">
        <h2>2. GÃ³p vá»‘n & Quá»¹ váº­n hÃ nh</h2>
        <div class="kvs" style="margin-top:6px">
            <div class="key">GiÃ¡ trá»‹ xe</div><div class="val nowrap" data-text="finance.vehiclePrice">â€”</div>
            <div class="key">Quá»¹ chung ban Ä‘áº§u</div><div class="val nowrap" data-text="finance.initialFund">â€”</div>
            <div class="key">TÃ i khoáº£n quá»¹</div><div class="val" data-text="finance.fundAccount">â€”</div>
            <div class="key">NguyÃªn táº¯c gÃ³p</div><div class="val" data-text="finance.contributionRule">â€”</div>
        </div>
        <p class="muted">CÃ¡c khoáº£n chi báº£o dÆ°á»¡ng, sáº¡c, vá»‡ sinhâ€¦ Ä‘Æ°á»£c thanh toÃ¡n tá»« Quá»¹ chung; khoáº£n cÃ¡ nhÃ¢n (náº¿u cÃ³) do cÃ¡ nhÃ¢n chi tráº£ theo bÃºt toÃ¡n bÃ¹ trá»«.</p>
    </div>

    <!-- Usage & rules -->
    <div class="section">
        <h2>3. Quyá»n sá»­ dá»¥ng & Lá»‹ch Ä‘áº·t</h2>
        <p>Viá»‡c sá»­ dá»¥ng xe Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua há»‡ thá»‘ng Ä‘áº·t lá»‹ch. Quy táº¯c Æ°u tiÃªn: <span data-text="usage.rule">â€”</span>. Má»—i BÃªn cam káº¿t tuÃ¢n thá»§ lá»‹ch Ä‘áº·t vÃ  hoÃ n tráº£ Ä‘Ãºng háº¹n.</p>
    </div>

    <div class="section">
        <h2>4. Báº£o dÆ°á»¡ng, Sá»­a chá»¯a & Báº£o hiá»ƒm</h2>
        <p>Xe Ä‘Æ°á»£c báº£o dÆ°á»¡ng Ä‘á»‹nh ká»³ theo khuyáº¿n nghá»‹ cá»§a hÃ£ng. TrÃ¡ch nhiá»‡m phÃª duyá»‡t chi phÃ­: <span data-text="maintenance.approval">â€”</span>. Há»£p Ä‘á»“ng báº£o hiá»ƒm: <span data-text="maintenance.insurance">â€”</span>.</p>
    </div>

    <div class="section">
        <h2>5. Giáº£i quyáº¿t tranh cháº¥p</h2>
        <p>Tranh cháº¥p phÃ¡t sinh Ä‘Æ°á»£c ghi nháº­n trÃªn há»‡ thá»‘ng vÃ  Æ°u tiÃªn hÃ²a giáº£i trong NhÃ³m. CÆ¡ cháº¿ biá»ƒu quyáº¿t: <span data-text="dispute.voting">â€”</span>. Tháº©m quyá»n cuá»‘i cÃ¹ng theo phÃ¡p luáº­t hiá»‡n hÃ nh.</p>
    </div>

    <div class="section">
        <h2>6. Äiá»u khoáº£n chung</h2>
        <ul>
            <li>Há»£p Ä‘á»“ng cÃ³ hiá»‡u lá»±c khi táº¥t cáº£ BÃªn Ä‘á»“ng sá»Ÿ há»¯u Ä‘á»“ng Ã½ vÃ  kÃ½.</li>
            <li>CÃ¡c phá»¥ lá»¥c (náº¿u cÃ³) lÃ  bá»™ pháº­n khÃ´ng tÃ¡ch rá»i cá»§a Há»£p Ä‘á»“ng.</li>
            <li>Há»‡ thá»‘ng lÆ°u váº¿t phiÃªn báº£n, thá»i Ä‘iá»ƒm kÃ½ vÃ  danh tÃ­nh ngÆ°á»i kÃ½.</li>
        </ul>
    </div>

    <!-- Signatures -->
    <div class="section break-avoid">
        <h2>7. Chá»¯ kÃ½ cÃ¡c BÃªn</h2>
        <div id="signature-grid" class="signatures">
            <!-- signature boxes injected here -->
        </div>
        <div class="footnote">Khi kÃ½ Ä‘iá»‡n tá»­, má»—i Ã´ chá»¯ kÃ½ sáº½ hiá»ƒn thá»‹ tÃªn, thá»i gian kÃ½ vÃ  fingerprint cá»§a chá»¯ kÃ½.</div>
    </div>

    <div class="section" style="margin-top:28px">
        <div class="muted">Äá»‹a Ä‘iá»ƒm kÃ½: <span data-text="contract.location">â€”</span> Â· NgÃ y: <span data-text="contract.signDate">â€”</span></div>
    </div>
</div>

<script>
    // --- Tiny binding helper -------------------------------------------------
    function setText(selectorKey, value){
        document.querySelectorAll(`[data-text="${selectorKey}"]`).forEach(el=> el.textContent = value ?? 'â€”');
    }
    function fmtCurrency(v){
        if(v==null) return 'â€”';
        try{ return new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND',maximumFractionDigits:0}).format(v); }
        catch{ return String(v); }
    }

    function render(data){
        // Contract meta
        setText('contract.number', data.contract.number);
        setText('group.name', data.group.name);
        setText('vehicle.model', data.vehicle.model);
        setText('vehicle.plate', data.vehicle.plate);
        setText('vehicle.vin', data.vehicle.vin);
        setText('vehicle.year', data.vehicle.year);
        setText('contract.effectiveDate', data.contract.effectiveDate);
        setText('contract.endDate', data.contract.endDate);
        setText('contract.termLabel', data.contract.termLabel);
        setText('contract.template', data.contract.template);
        setText('contract.location', data.contract.location);
        setText('contract.signDate', data.contract.signDate);

        // Finance
        setText('finance.vehiclePrice', fmtCurrency(data.finance.vehiclePrice));
        setText('finance.initialFund', fmtCurrency(data.finance.initialFund));
        setText('finance.fundAccount', data.finance.fundAccount);
        setText('finance.contributionRule', data.finance.contributionRule);

        // Usage / Maintenance / Dispute
        setText('usage.rule', data.usage.rule);
        setText('maintenance.approval', data.maintenance.approval);
        setText('maintenance.insurance', data.maintenance.insurance);
        setText('dispute.voting', data.dispute.voting);

        // Status badge
        const badge = document.getElementById('contract-status');
        badge.textContent = (data.contract.status || 'DRAFT').toUpperCase();

        // Owners
        const tbody = document.getElementById('owners-tbody');
        tbody.innerHTML = '';
        let sum = 0;
        (data.owners||[]).forEach((o,i)=>{
            sum += Number(o.share||0);
            const tr = document.createElement('tr');
            tr.innerHTML = `
          <td>${i+1}</td>
          <td><strong>${o.name}</strong></td>
          <td>${o.phone || ''}${o.email? ' Â· '+o.email:''}</td>
          <td>${o.idType||''} ${o.idNo||''}</td>
          <td class="right">${(o.share ?? 0)}%</td>`;
            tbody.appendChild(tr);
        });
        document.getElementById('ownership-sum').textContent = sum;

        // Signatures grid
        const grid = document.getElementById('signature-grid');
        grid.innerHTML = '';
        (data.owners||[]).forEach((o)=>{
            const box = document.createElement('div');
            box.className = 'sig-box';
            box.innerHTML = `
          <div><strong>${o.name}</strong></div>
          <div class="muted">KÃ½ & ghi rÃµ há» tÃªn</div>
          <div class="sig-line">Chá»¯ kÃ½</div>
          <div class="muted" style="font-size:12px">Tá»· lá»‡: ${o.share ?? 0}%</div>`;
            grid.appendChild(box);
        });
    }

    // --- Demo & helpers ------------------------------------------------------
    function fillDemo(){
        const demo = {
            contract:{ number:'EVS-2025-001', effectiveDate:'2025-10-20', endDate:'2026-10-19', termLabel:'12 thÃ¡ng', template:'STANDARD-1.0', status:'Draft', location:'HÃ  Ná»™i', signDate:'2025-10-20' },
            group:{ name:'EVShare â€“ NhÃ³m A' },
            vehicle:{ model:'VinFast VF 8 Plus', plate:'30A-123.45', vin:'RLVZZZ1EZBW000001', year:2024 },
            finance:{ vehiclePrice:950_000_000, initialFund:30_000_000, fundAccount:'MB Bank 0123456789 â€“ EVShare Group A', contributionRule:'Theo tá»· lá»‡ sá»Ÿ há»¯u' },
            usage:{ rule:'Äiá»ƒm tÃ­n dá»¥ng lá»‹ch sá»­ & phiÃªn bá»‘c thÄƒm tuáº§n' },
            maintenance:{ approval:'Biá»ƒu quyáº¿t > 50% theo tá»· lá»‡ sá»Ÿ há»¯u cho chi > 5 triá»‡u', insurance:'PVI â€“ GÃ³i váº­t cháº¥t toÃ n diá»‡n' },
            dispute:{ voting:'Äa sá»‘ theo tá»· lá»‡ sá»Ÿ há»¯u; náº¿u hoÃ  50/50, Æ°u tiÃªn lá»‹ch sá»­ Ä‘Ã³ng gÃ³p' },
            owners:[
                {name:'Nguyá»…n VÄƒn A', phone:'0901 234 567', email:'a@evshare.vn', idType:'CCCD', idNo:'012345678901', share:40},
                {name:'Tráº§n Thá»‹ B', phone:'0902 234 567', email:'b@evshare.vn', idType:'CCCD', idNo:'012345678902', share:35},
                {name:'LÃª VÄƒn C', phone:'0903 234 567', email:'c@evshare.vn', idType:'CCCD', idNo:'012345678903', share:25}
            ]
        };
        render(demo);
    }
    function clearAll(){ location.reload(); }

    // Auto demo on first load for preview
    fillDemo();
</script>
</body>
</html>
